let data = {
  _id: "5f0d9edf8c53f01714b87c69",
  harvestStatus: 1,
  chargeId: "ch_1H4XhFHitCcHm9i6qrcOixPU",
  transferGroup: "4365f9a4-c0cd-2ea5-a318-ab424c913add",
  userId: "5ef1e000f3dd1e32bc340b2b",
  amount: 191.5,
  deliveryFees: 0,
  totalPrice: 191.5,
  billingInfo: {
    firstName: "ritesh",
    lastName: "ritesh",
    addressLine1: "ritesh",
    addressLine2: "ritesh",
    city: "ritesh",
    state: "ritesh",
    country: "India",
    postalCode: "712232",
    phoneNumber: "5099962370",
  },
  buyList: [
    {
      totalPrice: 188,
      deliveryType: "",
      totalPayPrice: 188,
      courierType: "Pickup",
      deliveryFees: 10,
      addressLine1: "",
      addressLine2: "",
      city: "",
      state: "",
      postalCode: "",
      address: " Thursday ,04:30 PM-04:30 PM",
      farmName: "raj1's farm",
      _id: "5f0c42b85a4a35242b739ef9",
      farmId: "5ef4503152c6905b98e6dad2",
      productList: [
        {
          productQuantity: 1,
          productPrice: 20,
          totalPayPrice: 20,
          image:
            "https://healtyplanet-dev.nyc3.digitaloceanspaces.com/fileData_1594636861375_IMG_8415.JPG",
          productName: "Pizzad",
          unit: "kt",
          variety: "Qdddert",
          itemStatus: 1,
          _id: "5f0c42b85a4a35242b739efa",
          productId: "5f0c3a3e5a4a35242b739d5e",
        },
        {
          productQuantity: 2,
          productPrice: 79,
          totalPayPrice: 158,
          image:
            "https://healtyplanet-dev.nyc3.digitaloceanspaces.com/fileData_1594298231380_veg4.jfif",
          productName: "Ddddddddd",
          unit: "pint",
          variety: "1",
          itemStatus: 1,
          _id: "5f0cbaf45a4a35242b739f75",
          productId: "5f070f7758b2dd2650b7ef33",
        },
        {
          productQuantity: 1,
          productPrice: 10,
          totalPayPrice: 10,
          image:
            "https://healtyplanet-dev.nyc3.digitaloceanspaces.com/fileData_1594636664122_Carrots.jpeg",
          productName: "Bananas",
          unit: "pint",
          variety: "12",
          itemStatus: 1,
          _id: "5f0cbb135a4a35242b739f7b",
          productId: "5f0c39865a4a35242b739d56",
        },
      ],
      farmUserId: "5eedd8ca09e7b15ae52c3e3a",
    },
    {
      totalPrice: 3.5,
      deliveryType: "",
      totalPayPrice: 3.5,
      courierType: "Pickup",
      deliveryFees: 9,
      addressLine1: "",
      addressLine2: "",
      city: "",
      state: "",
      postalCode: "",
      address: "vijay nagar sector-71 noida 201301 Thursday ,11:30 AM-01:30 PM",
      farmName: "bani's ",
      _id: "5f0c43c95a4a35242b739f01",
      farmId: "5ef1dabef3dd1e32bc340b26",
      productList: [
        {
          productQuantity: 1,
          productPrice: 3.5,
          totalPayPrice: 3.5,
          image:
            "https://healtyplanet-dev.nyc3.digitaloceanspaces.com/fileData_1594112569818_veg2.jfif",
          productName: "Fddddddddddd",
          unit: "1",
          variety: "Latest",
          itemStatus: 1,
          _id: "5f0c43c95a4a35242b739f02",
          productId: "5f043a39f2c29e6ae856f796",
        },
      ],
      farmUserId: "5ef1d9d9f3dd1e32bc340b24",
    },
    {
      totalPrice: 260,
      deliveryType: "",
      totalPayPrice: 240,
      courierType: "Pickup",
      deliveryFees: 20,
      addressLine1: "",
      addressLine2: "",
      city: "",
      state: "",
      postalCode: "",
      address: " Thursday ,04:30 PM-04:30 PM",
      farmName: "marvel's farm",
      _id: "5f0c42b85a4a35242b739ef9",
      farmId: "5ef4503152c6905b98e6dad2",
      productList: [
        {
          productQuantity: 1,
          productPrice: 100,
          totalPayPrice: 100,
          image:
            "https://healtyplanet-dev.nyc3.digitaloceanspaces.com/fileData_1594636861375_IMG_8415.JPG",
          productName: "iron",
          unit: "kt",
          variety: "Qdddert",
          itemStatus: 1,
          _id: "5f0c42b85a4a35242b71qw2",
          productId: "5f0c3a3e5a4a35242b739d5e",
        },
        {
          productQuantity: 2,
          productPrice: 40,
          totalPayPrice: 80,
          image:
            "https://healtyplanet-dev.nyc3.digitaloceanspaces.com/fileData_1594298231380_veg4.jfif",
          productName: "nickle",
          unit: "pint",
          variety: "1",
          itemStatus: 1,
          _id: "5f0cbaf45a4a35242b739f75",
          productId: "5f070f7758b2dd2650b7ef33",
        },
        {
          productQuantity: 4,
          productPrice: 15,
          totalPayPrice: 60,
          image:
            "https://healtyplanet-dev.nyc3.digitaloceanspaces.com/fileData_1594636664122_Carrots.jpeg",
          productName: "copper",
          unit: "pint",
          variety: "12",
          itemStatus: 1,
          _id: "5f0cbb135a4a123442b739f7b",
          productId: "5f0c39865a4a35242b739d56",
        },
      ],
      farmUserId: "5eedd8ca09e7b15ae52c3e3a",
    },
    {
      totalPrice: 500,
      deliveryType: "",
      totalPayPrice: 500,
      courierType: "Pickup",
      deliveryFees: 0,
      addressLine1: "",
      addressLine2: "",
      city: "",
      state: "",
      postalCode: "",
      address: " Thursday ,04:30 PM-04:30 PM",
      farmName: "old's farm",
      _id: "5f0c42b85a4a35242b739ef9",
      farmId: "5ef4503152c6905b98e6dad2",
      productList: [
        {
          productQuantity: 1,
          productPrice: 240,
          totalPayPrice: 240,
          image:
            "https://healtyplanet-dev.nyc3.digitaloceanspaces.com/fileData_1594636861375_IMG_8415.JPG",
          productName: "gold",
          unit: "kt",
          variety: "Qdddert",
          itemStatus: 1,
          _id: "5f0c42b85a4a35242b739efa",
          productId: "5f0c3a3e5a4a35242b739d5e",
        },
        {
          productQuantity: 2,
          productPrice: 5,
          totalPayPrice: 10,
          image:
            "https://healtyplanet-dev.nyc3.digitaloceanspaces.com/fileData_1594298231380_veg4.jfif",
          productName: "silver",
          unit: "pint",
          variety: "1",
          itemStatus: 1,
          _id: "5f0cbaf45a4a35242b739f75",
          productId: "5f070f7758b2dd2650b7ef33",
        },
        {
          productQuantity: 10,
          productPrice: 25,
          totalPayPrice: 250,
          image:
            "https://healtyplanet-dev.nyc3.digitaloceanspaces.com/fileData_1594636664122_Carrots.jpeg",
          productName: "plates",
          unit: "pint",
          variety: "12",
          itemStatus: 1,
          _id: "5f0cbb11qsdwa35242b739f7b",
          productId: "5f0c39865a4a35242b739d56",
        },
      ],
      farmUserId: "5eedd8ca09e7b15ae52c3e3a",
    },
    {
      totalPrice: 1800,
      deliveryType: "",
      totalPayPrice: 1800,
      courierType: "Pickup",
      deliveryFees: 100,
      addressLine1: "",
      addressLine2: "",
      city: "",
      state: "",
      postalCode: "",
      address: " Thursday ,04:30 PM-04:30 PM",
      farmName: "new mart",
      _id: "5f0c42b85a4a31qw32qwe39ef9",
      farmId: "5ef4503152c6905b98e6dad2",
      productList: [
        {
          productQuantity: 1,
          productPrice: 200,
          totalPayPrice: 200,
          image:
            "https://healtyplanet-dev.nyc3.digitaloceanspaces.com/fileData_1594636861375_IMG_8415.JPG",
          productName: "Pizza",
          unit: "kt",
          variety: "Qdddert",
          itemStatus: 1,
          _id: "5f0c42b85a4a35242b739efa",
          productId: "5f0c3a3e5a4a35242b739d5e",
        },
        {
          productQuantity: 4,
          productPrice: 25,
          totalPayPrice: 100,
          image:
            "https://healtyplanet-dev.nyc3.digitaloceanspaces.com/fileData_1594298231380_veg4.jfif",
          productName: "Ddddddddd",
          unit: "pint",
          variety: "1",
          itemStatus: 1,
          _id: "5f0cbaf45a4a35242b739f75",
          productId: "5f070f7758b2dd2650b7ef33",
        },
        {
          productQuantity: 150,
          productPrice: 10,
          totalPayPrice: 1500,
          image:
            "https://healtyplanet-dev.nyc3.digitaloceanspaces.com/fileData_1594636664122_Carrots.jpeg",
          productName: "Bananas",
          unit: "pint",
          variety: "12",
          itemStatus: 1,
          _id: "5f0cbb135a4a35242b739f7b",
          productId: "5f0c39865a4a35242b739d56",
        },
      ],
      farmUserId: "5eedd8ca09e7b15ae52c3e3a",
    },
  ],
  status: "1",
  created: "2020-07-13T19:52:17.588Z",
  updated: "2020-07-13T19:52:17.588Z",
  __v: 0,
};
// Function for event handler filter and merge the duplicate object



function requestData() {
  let product = [];
  $("#byLists td").remove();
  $("#itemsLists td").remove();
  data.buyList.map((value) => {
    let raw = "";
    raw = `
        <tr>
            <td>${value.totalPrice}</td>
            <td>${value.totalPayPrice}</td>
            <td>${value.deliveryFees}</td>
            <td>${value.farmName}</td>
      </tr>
      `;
    $("#byLists").append(raw);
    value.productList.map((values) => {
      product.push({
        name: values.productName,
        quantity: values.productQuantity,
        price: values.productPrice,
        perPrice: values.totalPayPrice,
      });
    });
  });

  let seen = {};
  // filter and merge the duplicate product
  product = product.filter(function (entry) {
    let previous;
    // Have we seen this label before?
    if (seen.hasOwnProperty(entry.name)) {
      // Yes, grab it and add this data to it
      previous = seen[entry.name];
      previous.quantity.push(entry.quantity);
      previous.price.push(entry.price);
      previous.perPrice.push(entry.perPrice);
      // Don't keep this entry, we've merged it into the previous one
      return false;
    }
    // entry.data probably isn't an array; make it one for consistency
    if (!Array.isArray(entry.quantity)) {
      entry.quantity = [entry.quantity];
    }
    if (!Array.isArray(entry.price)) {
      entry.price = [entry.price];
    }
    if (!Array.isArray(entry.perPrice)) {
      entry.perPrice = [entry.perPrice];
    }
    // Remember that we've seen it
    seen[entry.name] = entry;
    // Keep this one, we'll merge any others that match into it
    return true;
  });

  // loop over the product => item
  product.forEach((val) => {
    let rows = "";
    if (val.perPrice.length > 1) {
      // if item contain array then merging them and calculating avarage
      // else append the item as it is!

      let totalPrice = val.perPrice.reduce((acc, cu) => {
        return acc + cu;
      });
      let totalQuantity = val.quantity.reduce((acc, cu) => {
        return acc + cu;
      });
      let payPerPrice = val.price.reduce((acc, cu) => {
        return acc + cu;
      });
      raws = `
    <tr>
    <td>${totalQuantity}</td>
    <td>${totalPrice}</td>
    <td>${totalPrice/totalQuantity}</td>
    <td>${val.name}</td>
    </tr>
    `;
    } else {
      raws = `
    <tr>
    <td>${val.quantity}</td>
    <td>${val.perPrice}</td>
    <td>${val.price}</td>
    <td>${val.name}</td>
    </tr>
    `;
    }
    $("#itemsLists").append(raws);
  });
}
